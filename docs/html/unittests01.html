<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>C++ LRU Cache Template: Unit Testing Framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Unit Testing Framework </h1>  </div>
</div>
<div class="contents">
<p>See implementation in <a class="el" href="unit__test_8h.html">unit_test.h</a></p>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<h2><a class="anchor" id="writing"></a>
Writing Unit Tests</h2>
<dl class="user"><dt><b></b></dt><dd>Ideally, unit tests are written with the code they test. The easiest way to do this is to include all the unit tests at the bottom of each source that they relate too. It's also possible to create source files of nothing but tests to expand coverage across multiple translation modules. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Let's take a simple example: we have a new function that adds two numbers. <div class="fragment"><pre class="fragment"> <span class="keywordtype">int</span> addTwoNumbers( <span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b ) {
   <span class="keywordflow">return</span> a + b;
 }
</pre></div> To write a unit test that checks that <img class="formulaInl" alt="$addTwoNumbers(x_1,x_2)=x_1+x_2$" src="form_0.png"/> we would write the unit test like so: <div class="fragment"><pre class="fragment"><span class="preprocessor"> #ifdef UNITTEST</span>
<span class="preprocessor"></span><span class="preprocessor"> #include &quot;<a class="code" href="unit__test_8h.html">unit_test.h</a>&quot;</span>

 <a class="code" href="unit__test_8h.html#a5f3fe0e0e85d0dc03672f96e5e95856f" title="Start of inline Unit Test definitions Use this to start the list of unit tests. This should be follow...">UNIT_TEST_DEFINES</a>

 <a class="code" href="unit__test_8h.html#ad3bccea4c3142d58fd5510f65503b300" title="Start a new test definition.">DEFINE_TEST</a>( check_two_plus_two ) {
   <a class="code" href="unit__test_8h.html#aa37d553e7d644c165c888bed8908de20" title="Use within a Unit Test to verify a condition.">unit_assert</a>( <span class="stringliteral">&quot;2+2=4&quot;</span>, addTwoNumbers(2,2)==4 );
 }

 <a class="code" href="unit__test_8h.html#a86b577b8af9cc6df174dc0e2e292c365" title="Start a Unit test run section.">UNIT_TEST_RUN</a>( <span class="stringliteral">&quot;addTwoNumbers Tests&quot;</span> )
   <a class="code" href="unit__test_8h.html#a758baec4c57fa6aeaf800e2c631a7d9f" title="Adds a defined test to test run.">ADD_TEST</a>( check_two_plus_two )
 <a class="code" href="unit__test_8h.html#a732dd1ba2cfc9163d60e05628b4544dc" title="Finish a Unit Test run section.">UNIT_TEST_END</a>

 <span class="preprocessor">#endif // UNITTEST</span>
</pre></div> </dd></dl>
<dl class="user"><dt><b></b></dt><dd>Now we have a test suite defined that will only be compiled when we define UNITTEST. UNIT_TEST_RUN actually creates a main() function that runs the tests so if we put this code into a file (say add.cpp) then we can compile and run it like so: <div class="fragment"><pre class="fragment">
# gcc -DUNITTEST -o unit_test_add add.cpp
# ./unit_test_add
---[ addTwoNumbers Tests ]---
  2+2=4: PASSED
</pre></div> </dd></dl>
<dl class="user"><dt><b></b></dt><dd>So far so good, let's add a new test that we think will fail. <div class="fragment"><pre class="fragment"><span class="preprocessor"> #ifdef UNITTEST</span>
<span class="preprocessor"></span><span class="preprocessor"> #include &quot;<a class="code" href="unit__test_8h.html">unit_test.h</a>&quot;</span>

 <a class="code" href="unit__test_8h.html#a5f3fe0e0e85d0dc03672f96e5e95856f" title="Start of inline Unit Test definitions Use this to start the list of unit tests. This should be follow...">UNIT_TEST_DEFINES</a>

 <a class="code" href="unit__test_8h.html#ad3bccea4c3142d58fd5510f65503b300" title="Start a new test definition.">DEFINE_TEST</a>( check_two_plus_two ) {
   <a class="code" href="unit__test_8h.html#aa37d553e7d644c165c888bed8908de20" title="Use within a Unit Test to verify a condition.">unit_assert</a>( <span class="stringliteral">&quot;2+2=4&quot;</span>, addTwoNumbers(2,2)==4 );
   <a class="code" href="unit__test_8h.html#aa2a4504968cf4e8abfc7b706106d4084" title="Use to end a unit test in success.">unit_pass</a>();
 }

 <a class="code" href="unit__test_8h.html#ad3bccea4c3142d58fd5510f65503b300" title="Start a new test definition.">DEFINE_TEST</a>( check_bogus ) {
   <a class="code" href="unit__test_8h.html#aa37d553e7d644c165c888bed8908de20" title="Use within a Unit Test to verify a condition.">unit_assert</a>( <span class="stringliteral">&quot;1+5=9&quot;</span>, addTwoNumbers(1,5)==9 );
   <a class="code" href="unit__test_8h.html#aa2a4504968cf4e8abfc7b706106d4084" title="Use to end a unit test in success.">unit_pass</a>();
 }

 <a class="code" href="unit__test_8h.html#a86b577b8af9cc6df174dc0e2e292c365" title="Start a Unit test run section.">UNIT_TEST_RUN</a>( <span class="stringliteral">&quot;addTwoNumbers Tests&quot;</span> )
   <a class="code" href="unit__test_8h.html#a758baec4c57fa6aeaf800e2c631a7d9f" title="Adds a defined test to test run.">ADD_TEST</a>( check_negatives )
 <a class="code" href="unit__test_8h.html#a732dd1ba2cfc9163d60e05628b4544dc" title="Finish a Unit Test run section.">UNIT_TEST_END</a>

 <span class="preprocessor">#endif // UNITTEST</span>
</pre></div> Running the unit_test now we get: <div class="fragment"><pre class="fragment">
# gcc -DUNITTEST -o unit_test_add add.cpp
# ./unit_test_add
---[ addTwoNumbers Tests ]---
  2+2=4: PASSED
  1+5=9: FAILED
</pre></div> </dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<h2><a class="anchor" id="adding"></a>
Integrating with Automake</h2>
<dl class="user"><dt><b></b></dt><dd>Automake has the ability to define testing targets that get run when issue "make check" command. Adding these tests are pretty straight forward. For the above we would add this to our Makefile.am: <div class="fragment"><pre class="fragment">
TESTS = unit_test_add
noinst_PROGRAMS = unit_test_add
CLEANFILES = add_unit.cpp
unit_test_add_SOURCES = add_unit.cpp

%_unit.cpp: %.cpp
	$(CXX) -E -o $*_unit.cpp $*.C @CFLAGS@ -DUNITTEST=1
</pre></div> To add addtional unit tests you just modify the first four lines. For example: to add a new unit test suite in the file sub.C we might do this. <div class="fragment"><pre class="fragment">
TESTS = unit_test_add unit_test_sub
noinst_PROGRAMS = unit_test_add unit_test_sub
CLEANFILES = add_unit.cpp sub_unit.cpp
unit_test_add_SOURCES = add_unit.cpp
unit_test_sub_SOURCES = sub_unit.cpp
</pre></div> </dd></dl>
<h2><a class="anchor" id="Notes"></a>
Implementation Notes</h2>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun May 15 2011 20:17:32 for C++ LRU Cache Template by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
